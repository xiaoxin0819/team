<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>组队助手-终极修复版</title>
    <script>
        // 定义全局数据
        var list = [];

        // 录入功能
        function addM() {
            var n = document.getElementById('un').value;
            var j = document.getElementById('uj').value;
            var p = document.getElementById('up').value;
            if(!n || !j || !p) { alert("请填全信息"); return; }
            list.push({n:n, j:j, p:p, pre:[]});
            document.getElementById('un').value = "";
            show();
        }

        // 渲染功能
        function show() {
            var h = "";
            for(var i=0; i<list.length; i++){
                h += "<div style='border:1px solid #ccc;padding:10px;margin-bottom:10px;'>";
                h += "<b>"+list[i].n+"</b> ("+list[i].j+"|"+list[i].p+")<br>";
                for(var k=0; k<list.length; k++){
                    if(i!=k){
                        var isAct = list[i].pre.indexOf(list[k].n) > -1;
                        h += "<button onclick='sel("+i+",\""+list[k].n+"\")' style='background:"+(isAct?"#07c160":"#eee")+"'>"+list[k].n+"</button>";
                    }
                }
                h += "</div>";
            }
            document.getElementById('list').innerHTML = h || "暂无成员";
        }

        function sel(idx, name) {
            var m = list[idx];
            var p = m.pre.indexOf(name);
            if(p>-1) m.pre.splice(p,1); else {
                if(m.pre.length>=3) { alert("限选3人"); return; }
                m.pre.push(name);
            }
            show();
        }

        // 分享功能
        function share() {
            if(list.length==0) return;
            var url = window.location.origin + window.location.pathname + "?d=" + encodeURIComponent(JSON.stringify(list));
            document.getElementById('out').innerText = url;
            document.getElementById('box').style.display = "block";
        }

        window.onload = function() {
            var d = new URLSearchParams(window.location.search).get('d');
            if(d) { list = JSON.parse(decodeURIComponent(d)); show(); }
        }
    </script>
</head>
<body style="padding:20px; font-family:sans-serif; background:#f0f0f0;">
    <div style="background:#fff; padding:15px; border-radius:10px;">
        <h3>1. 录入</h3>
        <input id="un" placeholder="昵称" style="width:100%; margin-bottom:10px; padding:10px;">
        <input id="uj" placeholder="职业" style="width:100%; margin-bottom:10px; padding:10px;">
        <input id="up" placeholder="战力" style="width:100%; margin-bottom:10px; padding:10px;">
        <button onclick="addM()" style="width:100%; padding:10px; background:#07c160; color:#fff; border:none;">确定录入</button>
        <button onclick="share()" style="width:100%; padding:10px; background:#fa9d3b; color:#fff; border:none; margin-top:10px;">生成分享链接</button>
        <div id="box" style="display:none; background:#fffbe6; padding:10px; margin-top:10px; word-break:break-all; border:1px dashed #ff9500;">
            <p>请长按全选复制：</p>
            <div id="out" style="font-size:12px;"></div>
        </div>
    </div>
    <div style="margin-top:20px;">
        <h3>2. 名单</h3>
        <div id="list"></div>
    </div>
</body>
</html>
